-- A Work in Progress to discuss shared schema for group storage in PL

-- Abdu students called this group_type
-- Suggestion: maybe call group_criteria or group_config or group_contraints?
-- This group defines additional criteria or 'ownership' of the group, perhaps
-- if the group was autogenerated based on rules
--
-- Haven't implemented this yet because it seems more about group creation or constraints
-- on autogenerated groups. Because one group_config could be connected to multiple
-- groups this is pulled out to a different table
--CREATE TABLE IF NOT EXISTS group_config (
--    id BIGSERIAL PRIMARY KEY,
--    course_instance_id BIGINT NOT NULL REFERENCES course_instances(id) ON DELETE CASCADE ON UPDATE CASCADE,
--    scope_table TEXT,
--    scope_id INT,
--    type TEXT,
--    minimum INT,
--    maximum INT,
--    date timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
--    deleted_at timestamp with time zone
--);

CREATE TABLE IF NOT EXISTS groups (
    id BIGSERIAL PRIMARY KEY,
    course_instance_id BIGINT NOT NULL REFERENCES course_instances(id) ON DELETE CASCADE ON UPDATE CASCADE,
    name TEXT,      -- visible name of the group
    source TEXT,    -- ENUM type listing of group origin: json, autogenerated, manual

    -- pending adding a groups_config table?
    --group_config_id BIGINT REFERENCES group_config(id) ON DELETE CASCADE ON UPDATE CASCADE,
    date timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    deleted_at timestamp with time zone
);

-- simple join table, no extra metadata - that could be stored in audit logs if needed
CREATE TABLE IF NOT EXISTS group_users (
    group_id BIGINT REFERENCES groups(id),
    user_id BIGINT REFERENCES users,
    PRIMARY KEY (group_id, user_id)
);
