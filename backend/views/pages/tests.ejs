<!DOCTYPE html>
<html>
  <head>
    <%- include('../partials/head'); %>
    <script type="text/javascript" src="/javascripts/lodash.min.js"></script>
    <script type="text/javascript" src="/javascripts/d3.min.js"></script>
    <script type="text/javascript" src="/localscripts/histmini.js"></script>
  </head>
  <body>
    <%- include('../partials/navbar', {navPage: 'tests'}); %>
    <div id="content" class="container">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">Assessments</h3>
        </div>

        <table class="table table-condensed table-hover">
          <thead>
            <tr>
              <th style="width: 1%"></th>
              <th></th>
              <th>TID</th>
              <th class="cell-center">Students</th>
              <th class="cell-center">Scores</th>
              <th class="cell-center">Median</th>
            </tr>
          </thead>
          <tbody>
            <% results.forEach(function(result, i) { %>
            <% if (result.start_new_set) { %>
            <tr class="<%= result.color %>">
              <th colspan="6"><%= result.long_name %></th>
            </tr>
            <% } %>
            <tr>
              <td style="width: 1%">
                <a href="<%= urlPrefix %>/test/<%= result.id %>/" class="btn btn-<%= result.color %> btn-xs" role="button"><%= result.label %></a>
              </td>
              <td>
                <a href="<%= urlPrefix %>/test/<%= result.id %>/"><%= result.title %></a>
              </td>
              <td><%= result.tid %></td>

              <td class="cell-center"><%= result.number %></td>

              <% if (result.number > 0) { %>
              <td class="cell-center"><div id="scoreHist<%= i %>" class="miniHist"></div></td>
              <script>
                $(function() {
                    var data = [<%= result.score_hist %>];
                    var options = {
                        width: 60,
                        height: 20,
                    };
                    histmini("#scoreHist<%= i %>", data, options);
                });
              </script>
              <% } else { %>
              <td class="cell-center"></td>
              <% } %>

              <% if (result.number > 0) { %>
              <td class="cell-center"><%- include('../partials/scorebar', {score: result.median}); %></td>
              <% } else { %>
              <td class="cell-center"></td>
              <% } %>

            </tr>
            <% }); %>
          </tbody>
        </table>

        <div class="panel-footer">
          <p>
            Download <a href="<%= urlPrefix %>/tests/<%= csvFilename %>"><%= csvFilename %></a>
            (includes more statistics columns than displayed above)
          </p>
        </div>

      </div>
    </div>
  </body>
</html>
